<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8" />
  <meta content="width=device-width, initial-scale=1.0" name="viewport" />
  <title>Product Details</title>
  <link rel="icon" type="image/x-icon" href="data:image/x-icon;base64," />
  <script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
  <link rel="preconnect" href="https://fonts.gstatic.com/" crossorigin="" />
  <link rel="stylesheet" as="style" onload="this.rel='stylesheet'"
    href="https://fonts.googleapis.com/css2?display=swap&amp;family=Noto+Sans%3Awght%40400%3B500%3B700%3B900&amp;family=Space+Grotesk%3Awght%40400%3B500%3B700" />
  <style>
    .content-container {
      opacity: 0;
      transition: opacity 0.5s ease-in-out;
    }

    .content-container.loaded {
      opacity: 1;
    }

    .press-effect {
      transition: transform 0.1s ease-out;
    }

    .press-effect:active {
      transform: scale(0.97);
    }

    .no-scrollbar::-webkit-scrollbar {
      display: none;
    }

    .no-scrollbar {
      -ms-overflow-style: none;
      scrollbar-width: none;
    }
  </style>
</head>

<body class="bg-gray-100">
  <div class="mx-auto max-w-sm">
    <div class="relative bg-[#fcfbf8] min-h-screen">
      <div class="pb-40">
        <div id="product-details-container" class="content-container">
          <div class="flex items-center bg-[#fcfbf8] p-4 pb-2 justify-between">
            <a href="./all_products.html" class="text-[#1c1a0d] flex size-12 shrink-0 items-center">
              <svg xmlns="http://www.w3.org/2000/svg" width="24px" height="24px" fill="currentColor"
                viewBox="0 0 256 256">
                <path
                  d="M224,128a8,8,0,0,1-8,8H59.31l58.35,58.34a8,8,0,0,1-11.32,11.32l-72-72a8,8,0,0,1,0-11.32l72-72a8,8,0,0,1,11.32,11.32L59.31,120H216A8,8,0,0,1,224,128Z">
                </path>
              </svg>
            </a>
            <h2 class="text-[#1c1a0d] text-lg font-bold leading-tight tracking-[-0.015em] flex-1 text-center pr-12">Food
              Details</h2>
          </div>
          <div id="product-content"></div>
          <div id="related-products-section" class="pt-6"></div>
        </div>
      </div>
      <!-- Fixed Footer Area -->
      <div class="fixed bottom-0 z-10 w-full max-w-sm">
        <div id="footer-actions" class="flex px-4 py-3 bg-[#fcfbf8] border-t border-[#f3f2e7]"></div>
        <!-- Navigation Bar -->
        <div class="flex justify-around border-t border-[#f3f2e7] bg-[#fcfbf8] px-2 pb-3 pt-2">
          <a class="flex flex-1 flex-col items-center justify-end gap-1 text-[#9b924b]" href="./home.html">
            <div class="flex h-8 items-center justify-center"><svg xmlns="http://www.w3.org/2000/svg" width="24px"
                height="24px" fill="currentColor" viewBox="0 0 256 256">
                <path
                  d="M218.83,103.77l-80-75.48a1.14,1.14,0,0,1-.11-.11,16,16,0,0,0-21.53,0l-.11.11L37.17,103.77A16,16,0,0,0,32,115.55V208a16,16,0,0,0,16,16H96a16,16,0,0,0,16-16V160h32v48a16,16,0,0,0,16,16h48a16,16,0,0,0,16-16V115.55A16,16,0,0,0,218.83,103.77ZM208,208H160V160a16,16,0,0,0-16-16H112a16,16,0,0,0-16,16v48H48V115.55l.11-.1L128,40l79.9,75.43.11.1Z">
                </path>
              </svg></div>
            <p class="text-xs font-medium leading-normal tracking-[0.015em]">Home</p>
          </a>
          <a class="flex flex-1 flex-col items-center justify-end gap-1 text-[#9b924b]" href="./all_products.html">
            <div class="flex h-8 items-center justify-center"><svg xmlns="http://www.w3.org/2000/svg" width="24px"
                height="24px" fill="currentColor" viewBox="0 0 256 256">
                <path
                  d="M80,64a8,8,0,0,1,8-8H216a8,8,0,0,1,0,16H88A8,8,0,0,1,80,64Zm136,56H88a8,8,0,0,0,0,16H216a8,8,0,0,0,0-16Zm0,64H88a8,8,0,0,0,0,16H216a8,8,0,0,0,0-16ZM44,52A12,12,0,1,0,56,64,12,12,0,0,0,44,52Zm0,64a12,12,0,1,0,12,12A12,12,0,0,0,44,116Zm0,64a12,12,0,1,0,12,12A12,12,0,0,0,44,180Z">
                </path>
              </svg></div>
            <p class="text-xs font-medium leading-normal tracking-[0.015em]">List</p>
          </a>
          <a class="flex flex-1 flex-col items-center justify-end gap-1 text-[#9b924b]" href="./my_cart.html">
            <div class="flex h-8 items-center justify-center"><svg xmlns="http://www.w3.org/2000/svg" width="24px"
                height="24px" fill="currentColor" viewBox="0 0 256 256">
                <path
                  d="M222.14,58.87A8,8,0,0,0,216,56H54.68L49.79,29.14A16,16,0,0,0,34.05,16H16a8,8,0,0,0,0,16h18L59.56,172.29a24,24,0,0,0,5.33,11.27,28,28,0,1,0,44.4,8.44h45.42A27.75,27.75,0,0,0,152,204a28,28,0,1,0,28-28H83.17a8,8,0,0,1-7.87-6.57L72.13,152h116a24,24,0,0,0,23.61-19.71l12.16-66.86A8,8,0,0,0,222.14,58.87ZM96,204a12,12,0,1,1-12-12A12,12,0,0,1,96,204Zm96,0a12,12,0,1,1-12-12A12,12,0,0,1,192,204Zm4-74.57A8,8,0,0,1,188.1,136H69.22L57.59,72H206.41Z">
                </path>
              </svg></div>
            <p class="text-xs font-medium leading-normal tracking-[0.015em]">Cart</p>
          </a>
          <a class="flex flex-1 flex-col items-center justify-end gap-1 text-[#9b924b]" href="./orders.html">
            <div class="flex h-8 items-center justify-center"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 640" class="w-6 h-6" fill="currentColor">
                <path
                  d="M256 144C256 108.7 284.7 80 320 80C355.3 80 384 108.7 384 144L384 192L256 192L256 144zM208 192L144 192C117.5 192 96 213.5 96 240L96 448C96 501 139 544 192 544L448 544C501 544 544 501 544 448L544 240C544 213.5 522.5 192 496 192L432 192L432 144C432 82.1 381.9 32 320 32C258.1 32 208 82.1 208 144L208 192zM232 240C245.3 240 256 250.7 256 264C256 277.3 245.3 288 232 288C218.7 288 208 277.3 208 264C208 250.7 218.7 240 232 240zM384 264C384 250.7 394.7 240 408 240C421.3 240 432 250.7 432 264C432 277.3 421.3 288 408 288C394.7 288 384 277.3 384 264z" />
              </svg></div>
            <p class="text-xs font-medium leading-normal tracking-[0.015em]">Orders</p>
          </a>
          <a class="flex flex-1 flex-col items-center justify-end gap-1 text-[#9b924b]" href="./profile.html">
            <div class="flex h-8 items-center justify-center"><svg xmlns="http://www.w3.org/2000/svg" width="24px"
                height="24px" fill="currentColor" viewBox="0 0 256 256">
                <path
                  d="M230.92,212c-15.23-26.33-38.7-45.21-66.09-54.16a72,72,0,1,0-73.66,0C63.78,166.78,40.31,185.66,25.08,212a8,8,0,1,0,13.85,8c18.84-32.56,52.14-52,89.07-52s70.23,19.44,89.07,52a8,8,0,1,0,13.85-8ZM72,96a56,56,0,1,1,56,56A56.06,56.06,0,0,1,72,96Z">
                </path>
              </svg></div>
            <p class="text-xs font-medium leading-normal tracking-[0.015em]">Profile</p>
          </a>
        </div>
      </div>
    </div>
  </div>
  <script>
    const user = JSON.parse(localStorage.getItem('canteenUser'));
    if (!user) {
      window.location.href = './login.html';
    }

    function getCart() {
      return JSON.parse(localStorage.getItem('canteenCart')) || [];
    }

    function addToCart(product, quantity) {
      let cart = getCart();
      const existingProduct = cart.find(item => item.id === product.id);
      if (existingProduct) {
        existingProduct.quantity += quantity;
      } else {
        cart.push({ ...product, quantity: quantity });
      }
      localStorage.setItem('canteenCart', JSON.stringify(cart));
    }

    document.addEventListener('DOMContentLoaded', function () {
      const content = document.getElementById('product-details-container');
      const productContent = document.getElementById('product-content');
      const footerActions = document.getElementById('footer-actions');
      const relatedProductsSection = document.getElementById('related-products-section');
      const API_URL = '';
      const urlParams = new URLSearchParams(window.location.search);
      const productId = parseInt(urlParams.get('id'));

      if (!productId) {
        productContent.innerHTML = '<p class="p-4 text-red-500">No product selected.</p>';
        content.classList.add('loaded');
        return;
      }

      let currentProduct = null;
      let currentProductPrice = 0;

      fetch(`${API_URL}/products/${productId}`)
        .then(response => {
          if (!response.ok) throw new Error('Product not found');
          return response.json();
        })
        .then(product => {
          currentProduct = product;
          currentProductPrice = product.price;
          displayProduct(product);
          fetchRelatedProducts(product.id);
        })
        .catch(handleError);

      function updateButtonPrice() {
        const quantity = parseInt(document.getElementById('quantity').textContent);
        const total = quantity * currentProductPrice;
        const addToCartBtn = document.getElementById('add-to-cart-btn');
        if (addToCartBtn) {
            const btnSpan = addToCartBtn.querySelector('span');
            // Prevent updating if it's in the "Added!" state
            if (!addToCartBtn.hasAttribute('data-added')) {
                btnSpan.textContent = `Add to Cart - $${total.toFixed(2)}`;
            }
        }
      }

      function displayProduct(product) {
        productContent.innerHTML = `
            <div class="p-4">
              <div class="w-full bg-center bg-no-repeat bg-cover rounded-lg min-h-[218px]" style="background-image: url('${product.image_url}');"></div>
            </div>
            <h1 class="text-[#1c1a0d] text-[22px] font-bold px-4 pb-3 pt-1">${product.name}</h1>
            <p class="text-[#9b924b] text-base px-4 pb-3 pt-1">${product.description}</p>
            <div class="px-4 pt-4 flex items-center justify-between">
                <h3 class="text-[#1c1a0d] text-lg font-bold">Quantity</h3>
                <div class="flex items-center gap-4">
                    <button id="decrease-qty" class="flex items-center justify-center size-8 rounded-full bg-[#f3f2e7] text-2xl press-effect">-</button>
                    <span id="quantity" class="text-xl font-bold">1</span>
                    <button id="increase-qty" class="flex items-center justify-center size-8 rounded-full bg-[#f3f2e7] text-2xl press-effect">+</button>
                </div>
            </div>
          `;

        const addToCartBtn = document.createElement('button');
        addToCartBtn.id = 'add-to-cart-btn';
        addToCartBtn.className = "flex w-full h-12 items-center justify-center rounded-lg bg-[#f3dd39] text-base font-bold press-effect";
        addToCartBtn.innerHTML = `<span>Add to Cart - $${product.price.toFixed(2)}</span>`;
        
        addToCartBtn.onclick = () => {
          const quantity = parseInt(document.getElementById('quantity').textContent);
          addToCart(currentProduct, quantity);

          addToCartBtn.querySelector('span').textContent = 'Added!';
          addToCartBtn.style.backgroundColor = '#4ade80';
          addToCartBtn.setAttribute('data-added', 'true');

          setTimeout(() => {
            addToCartBtn.style.backgroundColor = '';
            addToCartBtn.removeAttribute('data-added');
            updateButtonPrice();
          }, 1500);
        };
        footerActions.innerHTML = '';
        footerActions.appendChild(addToCartBtn);

        setupQuantityControls();
        setTimeout(() => content.classList.add('loaded'), 100);
      }

      function fetchRelatedProducts(currentId) {
        fetch(`${API_URL}/products`)
          .then(response => response.json())
          .then(allProducts => {
            const related = allProducts.filter(p => p.id !== currentId).slice(0, 6);
            if (related.length > 0) {
              let relatedHTML = `
                            <div class="flex justify-between items-center px-4 pb-4">
                                <h3 class="text-[#1c1a0d] text-lg font-bold">You might also like</h3>
                                <a href="./all_products.html" class="text-[#9b924b] text-sm font-medium press-effect">See all</a>
                            </div>
                        `;
              relatedHTML += '<div class="flex space-x-4 overflow-x-auto pb-4 no-scrollbar pl-4 pr-4">';
              related.forEach(product => {
                relatedHTML += `
                            <a href="./product.html?id=${product.id}" class="flex flex-col gap-2 bg-[#f3f2e7] p-3 rounded-lg border w-36 shrink-0">
                              <div class="w-full aspect-square bg-cover rounded-lg" style="background-image: url('${product.image_url}');"></div>
                              <div>
                                <p class="text-sm font-medium truncate">${product.name}</p>
                                <p class="text-xs font-bold">$${product.price.toFixed(2)}</p>
                              </div>
                            </a>
                           `;
              });
              relatedHTML += '</div>';
              relatedProductsSection.innerHTML = relatedHTML;
            }
          })
          .catch(error => console.error('Error fetching related products:', error));
      }

      function setupQuantityControls() {
        const decreaseBtn = document.getElementById('decrease-qty');
        const increaseBtn = document.getElementById('increase-qty');
        const quantitySpan = document.getElementById('quantity');
        decreaseBtn.addEventListener('click', () => {
          let currentQty = parseInt(quantitySpan.textContent);
          if (currentQty > 1) {
            quantitySpan.textContent = currentQty - 1;
            updateButtonPrice();
          }
        });
        increaseBtn.addEventListener('click', () => {
          let currentQty = parseInt(quantitySpan.textContent);
          quantitySpan.textContent = currentQty + 1;
          updateButtonPrice();
        });
      }

      function handleError(error) {
        console.error('Error fetching product details:', error);
        productContent.innerHTML = `<p class="p-4 text-red-500">${error.message}. Please try again.</p>`;
        setTimeout(() => content.classList.add('loaded'), 100);
      }
    });
  </script>
</body>

</html>