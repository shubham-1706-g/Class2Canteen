<html>

<head>
  <meta charset="utf-8" />
  <meta content="width=device-width, initial-scale=1.0" name="viewport" />
  <link rel="preconnect" href="https://fonts.gstatic.com/" crossorigin="" />
  <link rel="stylesheet" as="style" onload="this.rel='stylesheet'"
    href="https://fonts.googleapis.com/css2?display=swap&amp;family=Noto+Sans%3Awght%40400%3B500%3B700%3B900&amp;family=Space+Grotesk%3Awght%40400%3B500%3B700" />
  <title>Profile</title>
  <link rel="icon" type="image/x-icon" href="data:image/x-icon;base64," />
  <script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
  <style>
    .content-container {
      opacity: 0;
      transition: opacity 0.5s ease-in-out;
    }

    .content-container.loaded {
      opacity: 1;
    }

    .interactive-card {
      cursor: pointer;
    }

    .edit-form {
      max-height: 0;
      overflow: hidden;
      transition: max-height 0.5s ease-in-out, padding 0.5s ease-in-out, margin 0.5s ease-in-out;
    }

    .edit-form.open {
      max-height: 500px;
      margin-top: 0.5rem;
      /* Add some space when it opens */
    }

    .press-effect {
      transition: transform 0.1s ease-out;
    }

    .press-effect:active {
      transform: scale(0.97);
    }
  </style>
</head>

<body class="bg-gray-100">
  <div class="mx-auto max-w-sm">
    <div class="relative bg-[#fcfbf8] min-h-screen">
      <div class="pb-24">
        <div class="content-container">
          <div class="flex items-center bg-[#fcfbf8] p-4 pb-2 justify-between">
            <a href="./home.html" class="text-[#1c1a0d] flex size-12 shrink-0 items-center"><svg
                xmlns="http://www.w3.org/2000/svg" width="24px" height="24px" fill="currentColor" viewBox="0 0 256 256">
                <path
                  d="M224,128a8,8,0,0,1-8,8H59.31l58.35,58.34a8,8,0,0,1-11.32,11.32l-72-72a8,8,0,0,1,0-11.32l72-72a8,8,0,0,1,11.32,11.32L59.31,120H216A8,8,0,0,1,224,128Z">
                </path>
              </svg></a>
            <h2 class="text-[#1c1a0d] text-lg font-bold leading-tight tracking-[-0.015em] flex-1 text-center pr-12">
              Profile</h2>
          </div>
          <div class="flex p-4 @container">
            <div class="flex w-full flex-col gap-4 items-center">
              <div class="flex gap-4 flex-col items-center">
                <div class="bg-center bg-no-repeat aspect-square bg-cover rounded-full min-h-32 w-32"
                  style='background-image: url("https://placehold.co/128x128/f3f2e7/1c1a0d?text=U");'></div>
                <div class="flex flex-col items-center justify-center">
                  <p id="profile-name"
                    class="text-[#1c1a0d] text-[22px] font-bold leading-tight tracking-[-0.015em] text-center"></p>
                  <p id="profile-email" class="text-[#9b924b] text-base font-normal leading-normal text-center"></p>
                </div>
              </div>
            </div>
          </div>
          <h3 class="text-[#1c1a0d] text-lg font-bold leading-tight tracking-[-0.015em] px-4 pb-2 pt-4">Account</h3>
          <div class="px-4 flex flex-col gap-2">
            <div id="edit-profile-btn"
              class="flex items-center gap-4 bg-[#f3f2e7] p-3 rounded-lg border border-[#e5e2d0] min-h-14 justify-between interactive-card">
              <p class="text-[#1c1a0d] text-base font-normal leading-normal flex-1 truncate">Edit Profile</p>
              <div class="shrink-0">
                <div class="text-[#1c1a0d] flex size-7 items-center justify-center"><svg
                    xmlns="http://www.w3.org/2000/svg" width="24px" height="24px" fill="currentColor"
                    viewBox="0 0 256 256">
                    <path
                      d="M181.66,133.66l-80,80a8,8,0,0,1-11.32-11.32L164.69,128,90.34,53.66a8,8,0,0,1,11.32-11.32l80,80A8,8,0,0,1,181.66,133.66Z">
                    </path>
                  </svg></div>
              </div>
            </div>

            <!-- Updated Edit Profile Form -->
            <div id="edit-profile-form" class="edit-form">
              <form class="p-4 flex flex-col gap-4 bg-white rounded-lg border border-[#e5e2d0]">
                <div class="flex flex-col gap-1">
                  <label for="first_name" class="text-sm font-medium text-[#1c1a0d] mb-1">First Name</label>
                  <input id="first_name" name="first_name" type="text" placeholder="Your first name"
                    class="form-input h-12 rounded-lg bg-[#f3f2e7] border-none focus:ring-2 focus:ring-[#f3dd39] text-[#1c1a0d] placeholder:text-[#9b924b]">
                </div>
                <div class="flex flex-col gap-1">
                  <label for="last_name" class="text-sm font-medium text-[#1c1a0d] mb-1">Last Name</label>
                  <input id="last_name" name="last_name" type="text" placeholder="Your last name"
                    class="form-input h-12 rounded-lg bg-[#f3f2e7] border-none focus:ring-2 focus:ring-[#f3dd39] text-[#1c1a0d] placeholder:text-[#9b924b]">
                </div>
                <div class="flex flex-col gap-1">
                  <label for="email_field" class="text-sm font-medium text-[#1c1a0d] mb-1">Email</label>
                  <input id="email_field" name="email" type="email" placeholder="your.email@example.com"
                    class="form-input h-12 rounded-lg bg-[#f3f2e7] border-none focus:ring-2 focus:ring-[#f3dd39] text-[#1c1a0d] placeholder:text-[#9b924b]">
                </div>
                <div id="update-error" class="text-red-500 text-sm h-4"></div>
                <div class="flex gap-3 mt-2">
                  <button type="button" id="cancel-edit-btn"
                    class="flex-1 h-12 rounded-lg bg-white text-[#1c1a0d] border border-[#e5e2d0] font-semibold press-effect">Cancel</button>
                  <button type="submit" id="save-edit-btn"
                    class="flex-1 h-12 rounded-lg bg-[#f3dd39] text-[#1c1a0d] font-bold press-effect">Save
                    Changes</button>
                </div>
              </form>
            </div>

            <div
              class="flex items-center gap-4 bg-[#f3f2e7] p-3 rounded-lg border border-[#e5e2d0] min-h-14 justify-between interactive-card">
              <p class="text-[#1c1a0d] text-base font-normal leading-normal flex-1 truncate">Payment Methods</p>
              <div class="shrink-0">
                <div class="text-[#1c1a0d] flex size-7 items-center justify-center"><svg
                    xmlns="http://www.w3.org/2000/svg" width="24px" height="24px" fill="currentColor"
                    viewBox="0 0 256 256">
                    <path
                      d="M181.66,133.66l-80,80a8,8,0,0,1-11.32-11.32L164.69,128,90.34,53.66a8,8,0,0,1,11.32-11.32l80,80A8,8,0,0,1,181.66,133.66Z">
                    </path>
                  </svg></div>
              </div>
            </div>
          </div>
          <h3 class="text-[#1c1a0d] text-lg font-bold leading-tight tracking-[-0.015em] px-4 pb-2 pt-4">Settings</h3>
          <div class="px-4 flex flex-col gap-2">
            <div
              class="flex items-center gap-4 bg-[#f3f2e7] p-3 rounded-lg border border-[#e5e2d0] min-h-14 justify-between">
              <p class="text-[#1c1a0d] text-base font-normal leading-normal flex-1 truncate">Notifications</p>
              <div class="shrink-0"><label
                  class="relative flex h-[31px] w-[51px] cursor-pointer items-center rounded-full border-none bg-[#e5e2d0] p-0.5 has-[:checked]:justify-end has-[:checked]:bg-[#f3dd39]">
                  <div class="h-full w-[27px] rounded-full bg-white"
                    style="box-shadow: rgba(0, 0, 0, 0.15) 0px 3px 8px, rgba(0, 0, 0, 0.06) 0px 3px 1px;"></div><input
                    type="checkbox" class="invisible absolute" />
                </label></div>
            </div>
            <div id="logout-btn"
              class="flex items-center gap-4 bg-[#f3f2e7] p-3 rounded-lg border border-[#e5e2d0] min-h-14 justify-between interactive-card mt-2">
              <p class="text-red-600 text-base font-normal leading-normal flex-1 truncate">Logout</p>
            </div>
          </div>
        </div>
      </div>
      <!-- Fixed 5-icon navigation bar -->
      <div class="fixed bottom-0 z-10 w-full max-w-sm">
        <div class="flex justify-around border-t border-[#f3f2e7] bg-[#fcfbf8] px-2 pb-3 pt-2">
          <a class="flex flex-1 flex-col items-center justify-end gap-1 text-[#9b924b]" href="./home.html">
            <div class="flex h-8 items-center justify-center"><svg xmlns="http://www.w3.org/2000/svg" width="24px"
                height="24px" fill="currentColor" viewBox="0 0 256 256">
                <path
                  d="M218.83,103.77l-80-75.48a1.14,1.14,0,0,1-.11-.11,16,16,0,0,0-21.53,0l-.11.11L37.17,103.77A16,16,0,0,0,32,115.55V208a16,16,0,0,0,16,16H96a16,16,0,0,0,16-16V160h32v48a16,16,0,0,0,16,16h48a16,16,0,0,0,16-16V115.55A16,16,0,0,0,218.83,103.77ZM208,208H160V160a16,16,0,0,0-16-16H112a16,16,0,0,0-16,16v48H48V115.55l.11-.1L128,40l79.9,75.43.11.1Z">
                </path>
              </svg></div>
            <p class="text-xs font-medium leading-normal tracking-[0.015em]">Home</p>
          </a>
          <a class="flex flex-1 flex-col items-center justify-end gap-1 text-[#9b924b]" href="./all_products.html">
            <div class="flex h-8 items-center justify-center"><svg xmlns="http://www.w3.org/2000/svg" width="24px"
                height="24px" fill="currentColor" viewBox="0 0 256 256">
                <path
                  d="M80,64a8,8,0,0,1,8-8H216a8,8,0,0,1,0,16H88A8,8,0,0,1,80,64Zm136,56H88a8,8,0,0,0,0,16H216a8,8,0,0,0,0-16Zm0,64H88a8,8,0,0,0,0,16H216a8,8,0,0,0,0-16ZM44,52A12,12,0,1,0,56,64,12,12,0,0,0,44,52Zm0,64a12,12,0,1,0,12,12A12,12,0,0,0,44,116Zm0,64a12,12,0,1,0,12,12A12,12,0,0,0,44,180Z">
                </path>
              </svg></div>
            <p class="text-xs font-medium leading-normal tracking-[0.015em]">List</p>
          </a>
          <a class="flex flex-1 flex-col items-center justify-end gap-1 text-[#9b924b]" href="./my_cart.html">
            <div class="flex h-8 items-center justify-center"><svg xmlns="http://www.w3.org/2000/svg" width="24px"
                height="24px" fill="currentColor" viewBox="0 0 256 256">
                <path
                  d="M222.14,58.87A8,8,0,0,0,216,56H54.68L49.79,29.14A16,16,0,0,0,34.05,16H16a8,8,0,0,0,0,16h18L59.56,172.29a24,24,0,0,0,5.33,11.27,28,28,0,1,0,44.4,8.44h45.42A27.75,27.75,0,0,0,152,204a28,28,0,1,0,28-28H83.17a8,8,0,0,1-7.87-6.57L72.13,152h116a24,24,0,0,0,23.61-19.71l12.16-66.86A8,8,0,0,0,222.14,58.87ZM180,192a12,12,0,1,1-12,12A12,12,0,0,1,180,192Zm-96,0a12,12,0,1,1-12,12A12,12,0,0,1,84,192Z">
                </path>
              </svg></div>
            <p class="text-xs font-medium leading-normal tracking-[0.015em]">Cart</p>
          </a>
          <a class="flex flex-1 flex-col items-center justify-end gap-1 text-[#9b924b]" href="./orders.html">
            <div class="flex h-8 items-center justify-center text-[#9b924b]">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 640" class="w-6 h-6" fill="currentColor">
                <path
                  d="M256 144C256 108.7 284.7 80 320 80C355.3 80 384 108.7 384 144L384 192L256 192L256 144zM208 192L144 192C117.5 192 96 213.5 96 240L96 448C96 501 139 544 192 544L448 544C501 544 544 501 544 448L544 240C544 213.5 522.5 192 496 192L432 192L432 144C432 82.1 381.9 32 320 32C258.1 32 208 82.1 208 144L208 192zM232 240C245.3 240 256 250.7 256 264C256 277.3 245.3 288 232 288C218.7 288 208 277.3 208 264C208 250.7 218.7 240 232 240zM384 264C384 250.7 394.7 240 408 240C421.3 240 432 250.7 432 264C432 277.3 421.3 288 408 288C394.7 288 384 277.3 384 264z" />
              </svg>
            </div>
            <p class="text-xs font-medium leading-normal tracking-[0.015em]">Orders</p>
          </a>
          <a class="flex flex-1 flex-col items-center justify-end gap-1 text-[#1c1a0d]" href="./profile.html">
            <div class="flex h-8 items-center justify-center"><svg xmlns="http://www.w3.org/2000/svg" width="24px"
                height="24px" fill="currentColor" viewBox="0 0 256 256">
                <path
                  d="M230.93,220a8,8,0,0,1-6.93,4H32a8,8,0,0,1-6.92-12c15.23-26.33,38.7-45.21,66.09-54.16a72,72,0,1,1,73.66,0c27.39,8.95,50.86,27.83,66.09,54.16A8,8,0,0,1,230.93,220Z">
                </path>
              </svg></div>
            <p class="text-xs font-medium leading-normal tracking-[0.015em]">Profile</p>
          </a>
        </div>
      </div>
    </div>
  </div>
  <script>
    const user = JSON.parse(localStorage.getItem('canteenUser'));
    if (!user) {
      window.location.href = './login.html';
    }

    document.addEventListener('DOMContentLoaded', function () {
      const content = document.querySelector('.content-container');
      const profileName = document.getElementById('profile-name');
      const profileEmail = document.getElementById('profile-email');
      const editProfileBtn = document.getElementById('edit-profile-btn');
      const editProfileForm = document.getElementById('edit-profile-form');
      const cancelEditBtn = document.getElementById('cancel-edit-btn');
      const saveForm = editProfileForm.querySelector('form');
      const logoutBtn = document.getElementById('logout-btn');
      const API_URL = '';

      function populateProfile(currentUser) {
        profileName.textContent = `${currentUser.first_name || ''} ${currentUser.last_name || ''}`.trim() || 'User';
        profileEmail.textContent = currentUser.email || '';

        saveForm.elements.first_name.value = currentUser.first_name || '';
        saveForm.elements.last_name.value = currentUser.last_name || '';
        saveForm.elements.email_field.value = currentUser.email || '';
      }

      populateProfile(user);

      editProfileBtn.addEventListener('click', () => {
        editProfileForm.classList.toggle('open');
      });

      cancelEditBtn.addEventListener('click', () => {
        editProfileForm.classList.remove('open');
      });

      saveForm.addEventListener('submit', (e) => {
        e.preventDefault();
        const updateError = document.getElementById('update-error');
        updateError.textContent = '';

        const updatedData = {
          first_name: saveForm.elements.first_name.value,
          last_name: saveForm.elements.last_name.value,
          email: saveForm.elements.email_field.value
        };

        fetch(`${API_URL}/users/${user.id}`, {
          method: 'PUT',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(updatedData)
        })
          .then(response => {
            if (!response.ok) return response.json().then(err => { throw new Error(err.detail) });
            return response.json();
          })
          .then(updatedUser => {
            localStorage.setItem('canteenUser', JSON.stringify(updatedUser));
            populateProfile(updatedUser);
            editProfileForm.classList.remove('open');
          })
          .catch(error => {
            console.error('Update error:', error);
            updateError.textContent = error.message || 'Failed to update profile.';
          });
      });

      logoutBtn.addEventListener('click', () => {
        localStorage.removeItem('canteenUser');
        localStorage.removeItem('canteenCart');
        window.location.href = './login.html';
      });

      setTimeout(() => {
        content.classList.add('loaded');
      }, 100);
    });
  </script>
</body>

</html>