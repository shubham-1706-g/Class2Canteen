<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Home - Class To Canteen</title>
    <link rel="stylesheet" href="../css/style.css">
    <link rel="stylesheet" href="../css/mobile.css">
</head>
<body>
    <header class="fixed-header">
        <div class="header-content">
            <h1 class="logo">Class To Canteen</h1>
            <div class="search-bar">
                <input type="text" id="search-input" placeholder="Search for food...">
                <button id="search-btn">Search</button>
            </div>
            <a href="cart.html" class="cart-icon">
                <!-- Using an inline SVG for easier styling -->
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="9" cy="21" r="1"></circle><circle cx="20" cy="21" r="1"></circle><path d="M1 1h4l2.68 13.39a2 2 0 0 0 2 1.61h9.72a2 2 0 0 0 2-1.61L23 6H6"></path></svg>
                <span id="cart-counter" class="cart-badge">0</span>
            </a>
        </div>
    </header>

    <main class="scrollable-content">
        <section class="welcome-section">
            <h2>Welcome, <span id="user-name">Student</span>!</h2>
            <p>What would you like to eat today?</p>
        </section>

        <section class="category-filters">
            <h3>Categories</h3>
            <div class="filters-container" id="category-filters">
                <button class="filter-btn active" data-category="All">All</button>
                <button class="filter-btn" data-category="Vegetarian">Vegetarian</button>
                <button class="filter-btn" data-category="Health Food">Health Food</button>
                <button class="filter-btn" data-category="Fast Food">Fast Food</button>
                <button class="filter-btn" data-category="South Indian">South Indian</button>
                <button class="filter-btn" data-category="Chinese">Chinese</button>
            </div>
        </section>

        <section class="popular-food">
            <h3>Popular Now</h3>
            <div class="food-grid" id="popular-food-grid">
                <!-- Popular food items will be injected here by JS -->
            </div>
        </section>

        <section class="more-restaurants">
            <h3>Our Restaurants</h3>
            <div class="restaurants-list" id="restaurants-list">
                <!-- Restaurant list will be injected here by JS -->
            </div>
        </section>
    </main>

    <footer class="bottom-nav">
        <a href="home.html" class="nav-item active">Home</a>
        <a href="cart.html" class="nav-item">Cart</a>
        <a href="orders.html" class="nav-item">Orders</a>
        <a href="#" id="profile-logout" class="nav-item">Profile</a>
    </footer>

    <!-- JS files need to be loaded in order -->
    <script src="https://cdn.jsdelivr.net/npm/sql.js@1.6.2/dist/sql-wasm.js"></script>
    <script src="../js/database.js"></script>
    <script src="../js/auth.js"></script>
    <script src="../js/cart.js"></script>
    <script src="../js/main.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const checkDB = setInterval(() => {
                if (window.db) {
                    clearInterval(checkDB);

                    // Initial setup
                    protectRoute();
                    const currentUser = getCurrentUser();
                    if (currentUser) {
                        document.getElementById('user-name').textContent = currentUser.name;
                    }

                    // Load content
                    loadPopularFood();
                    loadRestaurants();
                    updateCartCounter();

                    // Event Listeners
                    document.getElementById('profile-logout').addEventListener('click', (e) => {
                        e.preventDefault();
                        logoutUser();
                    });

                    document.getElementById('search-btn').addEventListener('click', () => {
                        const query = document.getElementById('search-input').value;
                        // Redirect to a search results page or filter on the same page
                        // For now, we can store it and move to menu page
                        sessionStorage.setItem('searchQuery', query);
                        window.location.href = 'menu.html';
                    });

                    document.getElementById('category-filters').addEventListener('click', (e) => {
                        if (e.target.matches('.filter-btn')) {
                            const category = e.target.dataset.category;
                            sessionStorage.setItem('categoryFilter', category);
                            window.location.href = 'menu.html';
                        }
                    });
                }
            }, 100);
        });
    </script>
</body>
</html>
